language: generic

os: osx
osx_image: xcode7.2

sudo: False

env:
  matrix:
    - CONDA_PY=27
    - CONDA_PY=34

  global:
    # Generated with "anaconda auth --create --name mpifft4py-2016 > token"
    # then "travis encrypt BINSTAR_TOKEN=token --repo spectralDNS/mpiFFT4py"
    #- secure: "Ducz6xTrnRxYW69/lCsGGBaqDMaGnSM1UW8WocKrCy4DhoFpdxyglcntQL9pcq4C/HGwvnBsorJCLxcLDkNnZ5est2akDPtPZvKrhpMFqLK3oO7GGTMB2ddLu50OdRz58fTUFlEDVHgmSKliHunN7IRleaLTXtbluFDUKTLs00krKO5NfqO6lGZ/fH1mNFmhjU4ZYWTkvTBi5Wb+kG6bLDiMQjBCYyG9erPrx4IPjbtiHM/W4JLXgxIMMuhUolSq6N3+xNSeQ+ynfjQNDZhMM6k/boZC0fnqQpTmqPKMk9mvwSXEiTUpNwLGrD8P9iHeMj1QTeF58qFKoPGOhQhSWuVq1BugPOoo9Wm28WzvAfcnPlj/EOAOGAqDRUq5mDc3tv2Ea5ErtKUFCJAb8iTrpJAINugbu74m0vqDOzkteGm69QSa9Lj3w1iMqJ5iP/zsAZy+cK+Egd77rL0EdvRoJeNEZoyPt1vUAmy3WJIJXAIWlSr8kHGbT1gnQunPlXZp+29jBfOz4OKOEAGNzQeSZwJTw75urWPS8yFAOlIOwJ8rt3toTpxlP/5lsIKU/J6ykSKiFRV0824Bv+K9fY6CtCxjZMbq4aJu2zZVoqni59tHs26PEbRzHRsXXvQlB1y4hvOteHQsePITmKuqSeAJn2MgQj5BBh01LW5c0MVNoaQ="
    secure: "gYYUCYOsAC62h3OCAxcOyZQx/Ss2z5HrISOoYn8ZIPTA0r3TeDH1bR3s0/jhvnHO5AHUzzqfAy6XC1TSOvIsXZcVkzwB7+PDRB9lDbLLcbU3cA6BnzRMw9hosOz7aJZN03gQG5/nsSh+gzSUMdVgt7MIRR7/u/5CdACvreV9GKlUXPIedmnOuyNM3806x5sD4XUfjHs6sqGIe+tD5r0cP2jQ2iNwZdtQCGn9GJwO/+1Nx6J5CNVcppKgvMbuer9BD3rM2z74ULmZSd3NooL3gwyGyDBz3C/FJfecK/2MkxKBbeP2cl8THqRWx9FO27fKLENdiB2QngRn3w1UFqzLig42+sI+Rpi8pMdexInRw6asTzbbgt+EqDN0LHNx5jfZo1Ju0o9EGAmpPPINktc/fnqfBhtw9e//D30euoy0X6kexliqImy9wtWvW9rl+PV1Pcs8EK7sJonzdWiYAbppnEDEhMq8EkQJuOoOvQKkaYWlyaiXoug53Ly2yTysRu0k1ZOIm1v/aUbiGufOiebiZ8YY+nYt7Af3NUnyjeuSMWm8SHDYwuqgUWZQq75OkY1vcyenKJbd9cVaD7VKvhbgFtnlAJM0oBXxurPScr+1b8fA2fqWDhDGZ5ciGdvfhWxsRGMnt78WSYHSbhgC4cSGFNUdARTYT331DTz5GzpqOqc="

before_install:
    # Remove homebrew.
    - brew remove --force $(brew list)
    - brew cleanup -s
    - rm -rf $(brew --cache)

install:
    - |
      MINICONDA_URL="https://repo.continuum.io/miniconda"
      MINICONDA_FILE="Miniconda3-latest-MacOSX-x86_64.sh"
      curl -L -O "${MINICONDA_URL}/${MINICONDA_FILE}"
      bash $MINICONDA_FILE -b
      source /Users/travis/miniconda3/bin/activate root
      conda config --set show_channel_urls true
      conda config --add channels conda-forge
      conda update -q conda
      conda install --yes --quiet conda-forge-build-setup
      source run_conda_forge_build_setup

script:
    - conda build conf/conda

after_success:
    - anaconda -t $BINSTAR_TOKEN upload --force /Users/travis/miniconda3/conda-bld/osx-64/*.tar.bz2 -c main
